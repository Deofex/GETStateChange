{% load static %}
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>GET State Changes</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/statechange.css' %}">
</head>


<body>
    <div class="container">
        <div class="row">
            <div class="col-8">
                <div class="page-header">
                    <h1><img src="{% static 'images/headerimage.png' %}" class="img-rounded" alt="GET header image"><a
                            href="/">GET
                            State Changes</a></h1>
                </div>
            </div>
        </div>
        <div class="row">

            <div class="col">
                <div class="col">
                    <div class="card graph">
                        <div class="card-body">
                            <canvas id="ChartStateChangesDay"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card graph">
                        <div class="card-body">
                            <canvas id="ChartStateChangesMonth"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card graph">
                        <div class="card-body">
                            <canvas id="ChartStateChangesQuarter"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="card graph">
                        <div class="card-body">
                            <canvas id="ChartWiringsDay"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="col">
                    <div class="card prognose">
                        <div class="row no-gutters align-items-center">
                            <div class="col-sm-4">
                                <img src="{% static 'images/buyback.png' %}" class="card-img-middle" alt="buyback">
                            </div>
                            <div class="col-sm-8">
                                <div class="card-body">
                                    <h5>Projection: Based on the last buyback.</h5>
                                    <p>For each state change being processed the GET token is needed. The amount of GET
                                        which is needed is partially bought back from the market and partially
                                        subsidized by the User Growth Fund. In the last buyback a single statechange
                                        cost €0.07 If this remains the same we can expect
                                        <b>{{getburned}}</b> GET to be burned this quarter, of which
                                        <b>{{openmarketgetburned}}</b> will be bought back from the open market for a
                                        value of <b>€{{burnbackvalue}}</b>. This is based on the current price of GET
                                        being <b>€{{geteurprice}}</b></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <table border=1 class="table table-condensed table-hover table-bordered table-dark table-sm"
                        style="border-collapse:collapse;">
                        <thead>
                            <tr>
                                <th>
                                    <p>Date</p>
                                </th>
                                <th>
                                    <p>Blocknumber</p>
                                </th>
                                <th>
                                    <p>Total state changes</p>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for statechange in statechanges %}
                            <tr data-toggle="collapse" data-target="#statechange{{ statechange.blocknumber }}"
                                class="accordion-toggle">
                                <td>
                                    <p>{{ statechange.date |date:"d-m-Y H:i" }}</p>
                                </td>
                                <td>
                                    <p>{{ statechange.blocknumber }}</p>
                                </td>
                                <td>
                                    <p>{{ statechange.sumstatechanges }}</p>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" class="hiddenRow">
                                    <div style="text-align: center;" class="accordian-body collapse"
                                        id="statechange{{ statechange.blocknumber }}">
                                        <p>The following state changes have been found in this block:</p>
                                        <div style="display: inline-block; text-align: left;">
                                            <p>
                                                <table border=2 class="table table-bordered table-dark">
                                                    <tr>
                                                        <td><i>Tickets created</i></td>
                                                        <td>{{ statechange.firings0count }}</td>
                                                        <td><i>Tickets blocked</i></td>
                                                        <td>{{ statechange.firings1count }}</td>
                                                        <td><i>Tickets sold in the primary market</i></td>
                                                        <td>{{ statechange.firings2count }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><i>Tickets sold in secondary market</i></td>
                                                        <td>{{ statechange.firings3count }}</td>
                                                        <td><i>Tickets bought back</i></td>
                                                        <td>{{ statechange.firings4count }}</td>
                                                        <td><i>Tickets cancelled</i></td>
                                                        <td>{{ statechange.firings5count }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><i>Ticket put for sale</i></td>
                                                        <td>{{ statechange.firings6count }}</td>
                                                        <td><i>No Show</i></td>
                                                        <td>{{ statechange.firings7count }}</td>
                                                        <td><i>Not resold</i></td>
                                                        <td>{{ statechange.firings8count }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><i>Not sold in primary market</i></td>
                                                        <td>{{ statechange.firings9count }}</td>
                                                        <td><i>Not sold in secondary market</i></td>
                                                        <td>{{ statechange.firings10count }}</td>
                                                        <td><i>Tickets scanned</i></td>
                                                        <td>{{ statechange.firings11count }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><i>Show over</i></td>
                                                        <td>{{ statechange.firings12count }}</td>
                                                        <td><i>Tickets unblocked</i></td>
                                                        <td>{{ statechange.firings13count }}</td>
                                                        <td><i>Wirings</i></td>
                                                        <td>{{ statechange.wiringscount }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><i>Unknown</i></td>
                                                        <td>{{ statechange.unknownscount }}</td>
                                                    </tr>
                                                </table>
                                            </p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>


                    <ul class="nav nav-fill pagination">
                        <li class="nav-item"><a class="page-link" href="?page=1">First</a></li>
                        {% if statechanges.has_previous %}
                        <li class="nav-item"><a class="page-link"
                                href="?page={{ statechanges.previous_page_number }}">Previous</a>
                        </li>
                        {% endif %}
                        {% for pagenr in pagenrs %}
                        {% if pagenr == statechanges.number %}
                        <li class="nav-item active"><a class="page-link" href="?page={{ pagenr }}">{{ pagenr }}</a>
                        </li>
                        {% endif %}
                        {% if pagenr != statechanges.number %}
                        <li class="nav-item"><a class="page-link" href="?page={{ pagenr }}">{{ pagenr }}</a></li>
                        {% endif %}
                        {% endfor %}
                        {% if statechanges.has_next %}
                        <li class="nav-item"><a class="page-link"
                                href="?page={{ statechanges.next_page_number }}">Next</a>
                        </li>
                        <li class="nav-item"><a class="page-link"
                                href="?page={{ statechanges.paginator.num_pages }}">Last</a>
                        </li>
                        {% endif %}
                    </ul>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-7">
                <div class="card graph">
                    <div class="card-body">
                        <canvas id="StateChangeTypesLast30Days"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="card prognose">
                    <div class="row no-gutters align-items-center">
                        <div class="col-sm-4">
                            <img src="{% static 'images/deofex.png' %}" class="card-img-middle" alt="Deofex Avatar">
                        </div>
                        <div class="col-sm-8">
                            <div class="card-body">
                                <h5 class="card-title">A word</h5>
                                <p>Hi guys, I'm trying to maintain this site when possible When you have new idea's
                                    for widgets, or want to see more data, please speak to me on Telegram.</p>
                                <p>All data on this site is dynamic and updated 5 minutes after each full hour.</p>
                                <p>Cheers, Deofex</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">This site is created by and for the GET community.</h5>
                        <p class="card-text">Join the GET community on Telegram, we will welcome you, like you, love you
                            and tell you everything you want to know about the GET Protocol project.</p>
                        <a href="https://t.me/getprotocol" class="btn btn-primary">Join GET Telegram</a>
                    </div>
                    <div class="card-footer text-muted">
                        This website is not affiliated with the GET Protocol Foundation. All the
                        information on this website is published in good faith and for general information purpose
                        only. If you notice bugs or have suggestions please contact Deofex via the GET Protocol
                        Telegram channel (see button above). If you are a website designer/developer and want to improve
                        this site, speak to him or check the source on the GitHub.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <script>
        var ctx = document.getElementById('ChartStateChangesMonth').getContext('2d');
        Chart.defaults.global.defaultFontColor = '#ffffff';
        Chart.defaults.global.defaultFontFamily = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [
                    {% for info in monthgraphinfo %}
                    '{{info.periodname}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                ],
        datasets: [{
            label: 'State Changes per Month',
            backgroundColor: '#000000',
            borderColor: '#01C696',
            data: [
                {% for info in monthgraphinfo %}
                        '{{info.statechanges}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                    ],
        pointBorderColor: '#01C696',
            pointBackgroundColor: '#ffffff',
                fontColor: '#ffffff',
                }]
            },

        // Configuration options go here
        options: {
            responsive: true,
                tooltips: {
                mode: 'index',
                    intersect: false,
                },
            hover: {
                mode: 'nearest',
                    intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Month'
                    }
                }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
            }
        }
        });
    </script>

    <script>
        var ctx = document.getElementById('ChartStateChangesQuarter').getContext('2d');
        Chart.defaults.global.defaultFontColor = '#ffffff';
        Chart.defaults.global.defaultFontFamily = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [
                    {% for info in quartergraphinfo %}
                '{{info.periodname}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
            ],
        datasets: [{
            label: 'State Changes per Quarter',
            backgroundColor: '#000000',
            borderColor: '#01C696',
            data: [
                {% for info in quartergraphinfo %}
                    '{{info.statechanges}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                ],
        pointBorderColor: '#01C696',
            pointBackgroundColor: '#ffffff',
                fontColor: '#ffffff',
            }]
        },

        // Configuration options go here
        options: {
            responsive: true,
                tooltips: {
                mode: 'index',
                    intersect: false,
            },
            hover: {
                mode: 'nearest',
                    intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Quarter'
                    }
                }],
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
            }
        }
    });
    </script>

    <script>
        var ctx = document.getElementById('ChartStateChangesDay').getContext('2d');
        Chart.defaults.global.defaultFontColor = '#ffffff';
        Chart.defaults.global.defaultFontFamily = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [
                    {% for info in daygraphinfo %}
                    '{{info.periodname}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                ],
        datasets: [{
            label: 'State Changes per day',
            backgroundColor: '#000000',
            borderColor: '#01C696',
            data: [
                {% for info in daygraphinfo %}
                        '{{info.statechanges}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                    ],
        pointBorderColor: '#01C696',
            pointBackgroundColor: '#ffffff',
                fontColor: '#ffffff',
                }]
            },

        // Configuration options go here
        options: {
            responsive: true,
                tooltips: {
                mode: 'index',
                    intersect: false,
                },
            hover: {
                mode: 'nearest',
                    intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Last 30 days',
                        padding: 1
                    }
                }]
            }
        }
        });
    </script>

    <script>
        var ctx = document.getElementById('ChartWiringsDay').getContext('2d');
        Chart.defaults.global.defaultFontColor = '#ffffff';
        Chart.defaults.global.defaultFontFamily = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [
                    {% for info in wiringgraphinfo %}
                    '{{info.periodname}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                ],
        datasets: [{
            label: 'New petri-nets (new events)',
            backgroundColor: '#000000',
            borderColor: '#01C696',
            data: [
                {% for info in wiringgraphinfo %}
                        '{{info.statechanges}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                    ],
        pointBorderColor: '#01C696',
            pointBackgroundColor: '#ffffff',
                fontColor: '#ffffff',
                }]
            },

        // Configuration options go here
        options: {
            responsive: true,
                tooltips: {
                mode: 'index',
                    intersect: false,
                },
            hover: {
                mode: 'nearest',
                    intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Last 30 days',
                        padding: 1
                    }
                }]
            }
        }
        });
    </script>

    <script>
        var ctx = document.getElementById('StateChangeTypesLast30Days').getContext('2d');
        Chart.defaults.global.defaultFontColor = '#ffffff';
        Chart.defaults.global.defaultFontFamily = '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [
                    {% for info in statechangetypeslast30day %}
                '{{info.periodname}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
            ],
        datasets: [{
            label: 'New petri-nets (new events)',
            backgroundColor: [
                '#01c696',
                '#00ad9b',
                '#009397',
                '#00798a',
                '#206074',
                '#2f4858',
                '#48d1cc'
            ],
            borderColor: '#01C696',
            data: [
                {% for info in statechangetypeslast30day %}
                    '{{info.statechanges}}'{% if not forloop.last %}, {% endif %}
        {% endfor %}
                ],
        pointBorderColor: '#01C696',
            pointBackgroundColor: '#ffffff',
                fontColor: '#ffffff',
            }]
        },

        // Configuration options go here
        options: {
            title: {
                display: true,
                    text: 'Amount of ticket statechanges in the last 30 days per statechange type'
            },
            responsive: true,
                tooltips: {
                mode: 'index',
                    intersect: false,
            },
            animation: {
                animateScale: true,
                    animateRotate: true
            }
        }
    });
    </script>

</body>

</html>